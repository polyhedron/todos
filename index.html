<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <title>polyhedron's react tutorial</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"/>

</head>
<body>

<div class="container mt-4">

    <div id="todoApp"></div>

</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.3/react.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.3/react-dom.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.34/browser.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.18.0/axios.js"></script>

<script type="text/babel">

    // Uses bootstrap v4 styles

    var Todo = React.createClass({
        getInitialState: function(){
            return {
                editing: false
            }
        },
        edit: function(){
            this.setState({
                editing: true
            });
        },
        save: function(){
            var textAreaVal = this.refs.todoTextArea.value;
            console.log(textAreaVal);
            this.setState({
                editing: false
            })
        },
        delete:function(){
            console.log('Delete Button Clicked');
        },
        renderView: function(){
            return (
                    <div className="col-lg-4 border pb-2">
                        <div className="todoText mb-3 mt-2">{this.props.children}</div>
                        <hr/>
                        <button onClick={this.edit} className="btn btn-primary">Edit</button>
                        <button onClick={this.delete} className="btn btn-danger ml-1">Delete</button>
                    </div>
            );
        },
        renderEdit: function(){
            return (
                    <div className="col-lg-4 border pb-2">
                        <textarea className="form-control mt-1" defaultValue={this.props.children} ref="todoTextArea"></textarea>
                        <hr/>
                        <button onClick={this.save} className="btn btn-success">Save</button>
                    </div>
            );
        },
        render: function() {
            if(this.state.editing){
                return this.renderEdit();
            } else {
                return this.renderView();
            }
        }
    });

    var TodoList = React.createClass({
        getInitialState: function() {
            return {
                todos: []
            }
        },
        componentDidMount: function(){
            var _this = this;

            this.serverRequest = axios.get("ajax/todos.php")
                .then(function(result) {
                    axios.get(
                        "ajax/todos.php",{
                            params: {
                                userID : 'bc9X'
                            }
                        }
                    ).then(function(result) {
                            _this.setState({
                                todos: result.data
                            });

                        });
                });

        },
        render: function(){
            return(
                    <div className="row todos">
                        {
                            this.state.todos.map(function(todoText, i){
                                return (<Todo key={i}>{todoText}</Todo>);
                            })
                        }
                    </div>
            )
        }
    });

    ReactDOM.render(<TodoList/>, document.getElementById('todoApp'));

</script>

</body>
</html>